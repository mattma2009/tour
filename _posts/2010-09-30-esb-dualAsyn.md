---
layout: post
title: 总线之双工异步
categories: [work]
tags: [soa eab]
---

在总线的运行时环境，我们期望尽可能采用异步的模式，包括异步的调用或者异步消息机制，从而比较有效的节省系统资源，提高系统吞吐量。但是往往实际场景中，前段是要等待同步返回的，比如，在柜面上做一个扣款操作，柜员是要一直等待这个操作有返回，成功也好、失败也好，才能进行下一个操作。

而在协议层往往是一个同步协议，接入到总线平台，当然总线内部是采用异步机制，而在协议端不得不做一个异步转同步的操作，在总线平台上还是有同步点。所以，我们做了以下思考，如何尽快能的消除这种同步点。当然，现在很多后台的核心系统大多数都可以支持异步接入接出，这是我们期望的方式。针对上述同步系统如何进行处理呢，当然总线可以给他提供一个客户端，或者它直接采用消息队列的方式接入总线，这都是建立在它能修改现在的存量系统的基础之上的。如果存量系统不能做修改又当如何处理呢。

我们提出了双工异步通讯机，通讯机解决了什么问题呢，其实同步点的问题并没有消失，只是对其进行了前移，外面的同步系统，先接入到通讯机，通讯机把同步协议转换成异步协议，接到总线平台，这样总线平台上的同步点就没有了。

在这种场景下，通讯机还可以充当负载均衡器的作用，通讯机收到交易请求，可以发到一个消息集群，后面总线集群可以在消息集群异步获取消息进行处理，所以，一笔请求，在请求的之后能够走的是总线A，响应的时候走的可能是总线B，当然前提是后端是服务系统也是异步的。这样，对于总线来说，前后端都成为了纯异步系统，是很非常好的。

当然，通讯机除了协议的同步转异步，负载均衡等功能外，还有具备故障探测、重启等功能。另外，通讯机，在作为负载均衡设备部署时，需要考虑高可用性HA，需要进行主备部署。